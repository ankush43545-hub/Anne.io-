<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Anne — Scribble DM (Improved)</title>
  <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Caveat:wght@400;600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- React + Babel (keeps single-file editable) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

  <style>
    :root{
      --bg:#fbfbfd;
      --card:#fff;
      --ink:#111114;
      --muted:#7b7b86;
      --accent:#ff7ab6;
      --glass: rgba(255,255,255,0.6);
      --shadow: 0 8px 30px rgba(11,12,20,0.06);
      --radius: 16px;
    }

    *{box-sizing:border-box}
    html,body,#root{height:100%}
    body{
      margin:0;
      font-family: Inter, 'Patrick Hand', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      background: linear-gradient(180deg, #f6f7fb 0%, #fbfbff 100%);
      color:var(--ink);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;align-items:center;justify-content:center;padding:20px;
    }

    /* Container - DM style card */
    .app{
      width:100%;max-width:920px;height:92vh;background:var(--card);border-radius:20px;box-shadow:var(--shadow);overflow:hidden;display:grid;grid-template-columns:1fr 380px;gap:18px;padding:18px;
      transition:all .35s cubic-bezier(.2,.9,.3,1);
    }

    /* Mobile: stack columns */
    @media (max-width:880px){
      .app{grid-template-columns:1fr; height:95vh;padding:12px}
    }

    /* Left: messages */
    .left{
      background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.8));
      border-radius:14px;padding:18px;display:flex;flex-direction:column;gap:12px;position:relative;overflow:hidden;
    }

    /* subtle paper grid */
    .left::before{
      content:'';position:absolute;inset:0;background-image:linear-gradient(transparent 0 28px,#eee 28px);opacity:0.18;pointer-events:none;mix-blend-mode:multiply;
    }

    .header{
      display:flex;gap:12px;align-items:center;padding-bottom:6px;border-bottom:1px dashed rgba(0,0,0,0.04);
    }

    .avatar{
      width:52px;height:52px;border-radius:50%;display:inline-grid;place-items:center;font-family:'Caveat',cursive;font-weight:700;border:2px solid var(--ink);transform:rotate(-4deg);background:linear-gradient(140deg,#fff,#fff);box-shadow:4px 6px 0 rgba(0,0,0,0.04);
    }

    /* when there's no messages, show a scribbly heart instead of the letter */
    .avatar .letter{font-size:20px}
    .avatar .heart{font-size:20px;opacity:0.9}

    .header h3{margin:0;font-family:'Caveat',cursive;font-size:20px;transform:rotate(-1deg)}
    .header p{margin:0;color:var(--muted);font-size:13px}

    /* messages area */
    .msgs{flex:1;overflow:auto;padding:12px 6px 6px;display:flex;flex-direction:column;gap:12px}
    .msgs::-webkit-scrollbar{width:8px}
    .msgs::-webkit-scrollbar-thumb{background:linear-gradient(#ccc,#999);border-radius:20px}

    /* single message row */
    .row{display:flex;gap:10px;align-items:flex-end}
    .row.you{justify-content:flex-end}
    .bubble{
      max-width:74%;padding:10px 12px;border-radius:14px;border:1.8px solid var(--ink);background:var(--card);font-size:15px;line-height:1.4;position:relative;box-shadow:0 6px 18px rgba(0,0,0,0.05);transition:transform .28s cubic-bezier(.2,.9,.3,1),opacity .25s
    }

    .row.you .bubble{background:linear-gradient(180deg,#fff7fb,#fff);border-color:rgba(0,0,0,0.06);}

    /* little tail */
    .bubble::after{content:'';position:absolute;bottom:-6px;left:14px;width:14px;height:14px;background:var(--card);border-right:1.8px solid var(--ink);border-bottom:1.8px solid var(--ink);transform:rotate(45deg)}
    .row.you .bubble::after{right:14px;left:auto;background:linear-gradient(180deg,#fff7fb,#fff);border-left:1.8px solid rgba(0,0,0,0.06);border-top:1.8px solid rgba(0,0,0,0.06);transform:rotate(-135deg)}

    /* time */
    .time{font-size:12px;color:var(--muted);margin-top:6px;text-align:right}

    /* small avatar next to bubble */
    .small-avatar{width:34px;height:34px;border-radius:50%;display:grid;place-items:center;border:2px solid var(--ink);transform:rotate(-3deg);font-family:'Caveat',cursive}

    /* typing indicator */
    .typing{display:inline-flex;gap:6px;align-items:center;padding:8px 10px;border-radius:12px;border:1.6px dashed rgba(0,0,0,0.06);background:linear-gradient(180deg,#fff,#fff7f7);}
    .dot{width:8px;height:8px;border-radius:50%;background:var(--ink);opacity:.45;animation:jump 1s infinite}
    .dot:nth-child(2){animation-delay:.12s}
    .dot:nth-child(3){animation-delay:.24s}
    @keyframes jump{0%,60%,100%{transform:translateY(0);opacity:.45}30%{transform:translateY(-8px);opacity:1}}

    /* Right column: starters / welcome */
    .right{background:linear-gradient(180deg,rgba(250,250,255,0.9),rgba(255,255,255,0.95));border-radius:14px;padding:18px;display:flex;flex-direction:column;gap:12px}

    .welcome{display:flex;flex-direction:column;align-items:center;gap:12px;padding-top:6px}
    .welcome .big{width:110px;height:110px;border-radius:50%;display:grid;place-items:center;border:3px solid var(--ink);font-family:'Caveat',cursive;font-size:34px;transform:rotate(-6deg);box-shadow:8px 8px 0 rgba(0,0,0,0.06)}
    .welcome h2{font-family:'Caveat',cursive;margin:0;transform:rotate(-2deg)}
    .welcome p{color:var(--muted);max-width:240px;text-align:center}

    .starters{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px}
    .starter{background:transparent;border:1.8px dashed rgba(0,0,0,0.06);padding:10px;border-radius:12px;text-align:left;font-family:'Patrick Hand',cursive;cursor:pointer;transition:transform .16s,box-shadow .16s}
    .starter:hover{transform:translateY(-4px);box-shadow:0 6px 18px rgba(0,0,0,0.06)}

    /* Input area - sticky, DM style */
    .composer{display:flex;gap:10px;padding:10px;border-radius:12px;background:linear-gradient(180deg,#ffffff,#fff);align-items:flex-end;border:1px solid rgba(0,0,0,0.04)}
    textarea{flex:1;min-height:44px;max-height:140px;border-radius:12px;padding:10px 12px;border:none;background:rgba(250,250,250,0.8);font-size:15px;font-family:Inter, 'Patrick Hand';resize:none;outline:none}
    .send{width:52px;height:52px;border-radius:50%;background:var(--accent);border:none;color:white;font-weight:700;display:grid;place-items:center;cursor:pointer;box-shadow:0 8px 22px rgba(255,122,182,0.18);transform:rotate(-6deg);transition:transform .12s}
    .send:active{transform:rotate(-2deg) scale(.98)}
    .send[disabled]{opacity:.4;cursor:not-allowed}

    /* small helpers */
    .muted{color:var(--muted);font-size:13px}

    /* animations */
    .fadeIn{animation:fadeIn .45s cubic-bezier(.2,.9,.3,1) both}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}

    /* accessibility focus */
    button:focus,textarea:focus{box-shadow:0 0 0 4px rgba(255,122,182,0.12);outline:none}
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const API_URL = 'https://anne-io.onrender.com/chat';

    function Avatar({role, showLetter}){
      // showLetter only after messages exist so the "middle letters" don't show on first load
      return (
        <div className="avatar" aria-hidden>
          {showLetter ? <span className="letter">A</span> : <span className="heart">♡</span>}
        </div>
      )
    }

    function SmallAv({who}){
      return <div className="small-avatar" aria-hidden>{who === 'anne' ? 'A' : 'You'}</div>
    }

    function App(){
      const [messages, setMessages] = useState([]);
      const [input, setInput] = useState('');
      const [typing, setTyping] = useState(false);
      const msgsRef = useRef(null);

      useEffect(()=>{
        // simulate a gentle intro animation / welcome message if you want
        // keep messages empty initially; avatar will show heart instead of 'A'
      },[])

      useEffect(()=>{
        // scroll to bottom smartly
        const el = msgsRef.current;
        if(!el) return;
        requestAnimationFrame(()=> el.scrollTo({top: el.scrollHeight, behavior:'smooth'}));
      },[messages, typing]);

      const formatTime = ()=> new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});

      const getHistory = ()=> messages.slice(-8).map(m=>({role: m.sender === 'user' ? 'user' : 'assistant', content: m.text}))

      async function sendMessage(text){
        if(!text.trim()) return;
        const userMsg = {id:Date.now(),sender:'user',text, time:formatTime()};
        setMessages(prev=>[...prev,userMsg]);
        setInput('');
        setTyping(true);

        try{
          const res = await fetch(API_URL,{
            method:'POST',headers:{'Content-Type':'application/json'},
            body: JSON.stringify({message:text, history:getHistory()})
          });
          if(!res.ok) throw new Error('network');
          const data = await res.json();
          setTimeout(()=>{
            setTyping(false);
            setMessages(prev=>[...prev,{id:Date.now()+1,sender:'anne',text: data.reply || 'hmm... i got distracted, try again?', time:formatTime()}]);
          },600);
        }catch(err){
          console.error(err);
          setTimeout(()=>{
            setTyping(false);
            setMessages(prev=>[...prev,{id:Date.now()+1,sender:'anne',text:'my brain is lagging — try again?', time:formatTime()}]);
          },600);
        }
      }

      const onKey = (e)=>{
        if(e.key === 'Enter' && !e.shiftKey){
          e.preventDefault(); sendMessage(input);
        }
      }

      return (
        <div className="app fadeIn" role="application" aria-label="Anne chat">
          <section className="left" aria-live="polite">
            <header className="header">
              <Avatar showLetter={messages.length>0} />
              <div>
                <h3>Anne</h3>
                <p className="muted">online — feels like a DM</p>
              </div>
            </header>

            <div className="msgs" ref={msgsRef} id="messages" aria-label="messages">
              {messages.length === 0 ? (
                <div style={{display:'grid',placeItems:'center',paddingTop:40}}>
                  <div style={{maxWidth:520,textAlign:'center'}}>
                    <div style={{fontFamily:'Caveat, cursive',fontSize:22,transform:'rotate(-2deg)',marginBottom:8}}>hey — i'm anne ♡</div>
                    <div className="muted">this is a cozy scribble-style dm. start with a starter below or type something.</div>
                  </div>
                </div>
              ) : null}

              {messages.map(m=> (
                <div key={m.id} className={`row ${m.sender === 'user' ? 'you' : ''}`}>
                  {m.sender !== 'user' && <SmallAv who='anne' />}
                  <div style={{display:'flex',flexDirection:'column',alignItems: m.sender === 'user' ? 'flex-end' : 'flex-start'}}>
                    <div className="bubble fadeIn">{m.text}</div>
                    <div className="time">{m.time}</div>
                  </div>
                  {m.sender === 'user' && <SmallAv who='you' />}
                </div>
              ))}

              {typing && (
                <div className="row">
                  <SmallAv who='anne' />
                  <div className="typing">
                    <div className="dot"></div>
                    <div className="dot"></div>
                    <div className="dot"></div>
                  </div>
                </div>
              )}
            </div>

            <div style={{paddingTop:8}}>
              <form onSubmit={(e)=>{e.preventDefault(); sendMessage(input)}} className="composer" aria-label="message composer">
                <textarea aria-label="message input" placeholder="write a message..." value={input} onChange={e=>setInput(e.target.value)} onKeyDown={onKey} />
                <button className="send" type="submit" disabled={!input.trim()} aria-label="send">
                  ➤
                </button>
              </form>
            </div>

          </section>

          <aside className="right">
            <div className="welcome">
              <div className="big">{messages.length>0 ? 'A' : '♡'}</div>
              <h2>friendly scribble DM</h2>
              <p className="muted">designed for mobile and desktop — smoother animations, scribbled borders, and a clean DM layout.</p>

              <div className="starters">
                <button className="starter" onClick={()=>sendMessage("hey what's up")}>hey what's up</button>
                <button className="starter" onClick={()=>sendMessage("how you been?")}>how you been?</button>
                <button className="starter" onClick={()=>sendMessage("what you doing rn")}>what you doing rn</button>
                <button className="starter" onClick={()=>sendMessage("tell me something")}>tell me something</button>
              </div>
            </div>

            <div style={{marginTop:8,fontSize:13,color:'var(--muted)'}}>Small tweaks included: improved padding, accessible focus states, better mobile stacking and smoother entry animations.</div>

          </aside>
        </div>
      )
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
